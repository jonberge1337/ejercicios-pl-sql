CREATE OR REPLACE PROCEDURE FECHAS_ARTI(DES IN PROVINCIAS.PROVINCIA%TYPE)
IS
	CURSOR CONSULTA IS
		SELECT *
		FROM ARTICULOS
		WHERE EXISTS(SELECT *
			  		 FROM PROVEEDORES, PROVINCIAS
					 WHERE ARTICULOS.PROVEEDOR = PROVEEDORES.PROVEEDOR
					 AND PROVINCIAS.PROVINCIA = PROVEEDORES.PROVINCIA
					 AND PROVINCIAS.DESCRIPCION = DES);
	BOR NUMBER(5) := 0;
	ACT NUMBER(5) := 0;
BEGIN
	FOR FILA IN CONSULTA LOOP
		IF FILA.FEC_ULT_ENT IS NULL AND FILA.FEC_ULT_SAL IS NULL THEN
		    DELETE FROM MIS_ARTICULOS
			WHERE FILA.ARTICULO = ARTICULO
			AND FILA.PROVEEDOR = PROVEEDOR;
			BOR := BOR + 1;
		ELSIF FILA.FEC_ULT_ENT IS NULL THEN
			UPDATE MIS_ARTICULOS
			SET FEC_ULT_ENT = SYSDATE;
			ACT := ACT + 1;
		ELSIF FILA.FEC_ULT_SAL IS NULL THEN
			UPDATE MIS_ARTICULOS
			SET FEC_ULT_SAL = SYSDATE;
			ACT := ACT + 1;			
		ELSIF FILA.FEC_ULT_ENT > FILA.FEC_ULT_SAL THEN
			UPDATE MIS_ARTICULOS
			SET FEC_ULT_SAL = FEC_ULT_ENT;
			ACT := ACT + 1;
		END IF;
	END LOOP;

	DBMS_OUTPUT.PUT_LINE(BOR ||' LINEAS HAN SIDO BORRADAS, '||ACT||' LINEAS HAN SIDO ACTUALIZADAS');
END FECHAS_ARTI;
/	
