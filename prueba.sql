CREATE OR REPLACE PROCEDURE ACTU_TOTAL(COD IN NUMBER)
IS
TOT NUMBER(10);
BEGIN
	SELECT SUM(CANTIDAD * PRECIO * (1 - DESCUENTO / 100)) INTO TOT
	FROM LINEAS, ALBARANES
	WHERE ALBARANES.CLIENTE = COD
	  AND ALBARANES.ALBARAN = LINEAS.ALBARAN;

	UPDATE CLIENTES
	SET TOTAL_FACTURA = TOT
	WHERE CLIENTE = COD;
EXCEPTION
	WHEN NO_DATA_FOUND THEN
	     DBMS_OUT.PUT_LINE('ERROR DATOS NO ENCONTRADO');
END ACTU_TOTAL;
/
